const fetch = require("node-fetch");
const { spawn } = require("child_process");

async function verifyImpl(
  address,
  contractName,
  network,
  license = "unlicensed"
) {
  return await new Promise((resolve, reject) => {
    const cmd = `truffle run blockscout ${contractName}@${address} --network ${network} --license ${license}`;
    const p = spawn("npx", cmd.split(" "), {
      stdio: "inherit",
    });
    console.log(`npx ${cmd}`);
    p.on("exit", (code) => resolve(code));
    p.on("error", (code) => reject(code));
  });
}

async function verifyProxy(address, network) {
  let url;
  switch (network) {
    case "sokol":
      url =
        "https://blockscout.com/poa/sokol/verify_smart_contract/contract_verifications";
      break;
    case "xdai":
      url =
        "https://blockscout.com/xdai/mainnet/verify_smart_contract/contract_verifications";
      break;
    default:
      throw new Error(`don't know how to verify on network ${network}`);
  }
  let response = await fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
    },
    body: `smart_contract%5Baddress_hash%5D=${address}&smart_contract%5Bname%5D=AdminUpgradeabilityProxy&smart_contract%5Bnightly_builds%5D=false&smart_contract%5Bcompiler_version%5D=v0.6.8%2Bcommit.0bbfe453&smart_contract%5Bevm_version%5D=default&smart_contract%5Boptimization%5D=true&smart_contract%5Boptimization_runs%5D=200&smart_contract%5Bcontract_source_code%5D=%2F%2F+Sources+flattened+with+hardhat+v2.2.0+https%3A%2F%2Fhardhat.org%0D%0A%0D%0A%2F%2F+File+contracts%2Fproxy%2FProxy.sol%0D%0A%0D%0A%2F%2F+SPDX-License-Identifier%3A+MIT%0D%0A%0D%0Apragma+solidity+%5E0.6.0%3B%0D%0A%0D%0A%2F**%0D%0A+*+%40title+Proxy%0D%0A+*+%40dev+Implements+delegation+of+calls+to+other+contracts%2C+with+proper%0D%0A+*+forwarding+of+return+values+and+bubbling+of+failures.%0D%0A+*+It+defines+a+fallback+function+that+delegates+all+calls+to+the+address%0D%0A+*+returned+by+the+abstract+_implementation%28%29+internal+function.%0D%0A+*%2F%0D%0Aabstract+contract+Proxy+%7B%0D%0A++%2F**%0D%0A+++*+%40dev+Fallback+function.%0D%0A+++*+Implemented+entirely+in+%60_fallback%60.%0D%0A+++*%2F%0D%0A++fallback+%28%29+payable+external+%7B%0D%0A++++_fallback%28%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Receive+function.%0D%0A+++*+Implemented+entirely+in+%60_fallback%60.%0D%0A+++*%2F%0D%0A++receive+%28%29+payable+external+%7B%0D%0A++++_fallback%28%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40return+The+Address+of+the+implementation.%0D%0A+++*%2F%0D%0A++function+_implementation%28%29+internal+virtual+view+returns+%28address%29%3B%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Delegates+execution+to+an+implementation+contract.%0D%0A+++*+This+is+a+low+level+function+that+doesn%27t+return+to+its+internal+call+site.%0D%0A+++*+It+will+return+to+the+external+caller+whatever+the+implementation+returns.%0D%0A+++*+%40param+implementation+Address+to+delegate.%0D%0A+++*%2F%0D%0A++function+_delegate%28address+implementation%29+internal+%7B%0D%0A++++assembly+%7B%0D%0A++++++%2F%2F+Copy+msg.data.+We+take+full+control+of+memory+in+this+inline+assembly%0D%0A++++++%2F%2F+block+because+it+will+not+return+to+Solidity+code.+We+overwrite+the%0D%0A++++++%2F%2F+Solidity+scratch+pad+at+memory+position+0.%0D%0A++++++calldatacopy%280%2C+0%2C+calldatasize%28%29%29%0D%0A%0D%0A++++++%2F%2F+Call+the+implementation.%0D%0A++++++%2F%2F+out+and+outsize+are+0+because+we+don%27t+know+the+size+yet.%0D%0A++++++let+result+%3A%3D+delegatecall%28gas%28%29%2C+implementation%2C+0%2C+calldatasize%28%29%2C+0%2C+0%29%0D%0A%0D%0A++++++%2F%2F+Copy+the+returned+data.%0D%0A++++++returndatacopy%280%2C+0%2C+returndatasize%28%29%29%0D%0A%0D%0A++++++switch+result%0D%0A++++++%2F%2F+delegatecall+returns+0+on+error.%0D%0A++++++case+0+%7B+revert%280%2C+returndatasize%28%29%29+%7D%0D%0A++++++default+%7B+return%280%2C+returndatasize%28%29%29+%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Function+that+is+run+as+the+first+thing+in+the+fallback+function.%0D%0A+++*+Can+be+redefined+in+derived+contracts+to+add+functionality.%0D%0A+++*+Redefinitions+must+call+super._willFallback%28%29.%0D%0A+++*%2F%0D%0A++function+_willFallback%28%29+internal+virtual+%7B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+fallback+implementation.%0D%0A+++*+Extracted+to+enable+manual+triggering.%0D%0A+++*%2F%0D%0A++function+_fallback%28%29+internal+%7B%0D%0A++++_willFallback%28%29%3B%0D%0A++++_delegate%28_implementation%28%29%29%3B%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0A%0D%0A%2F%2F+File+%40openzeppelin%2Fcontracts%2Futils%2FAddress.sol%40v3.4.1%0D%0A%0D%0Apragma+solidity+%3E%3D0.6.2+%3C0.8.0%3B%0D%0A%0D%0A%2F**%0D%0A+*+%40dev+Collection+of+functions+related+to+the+address+type%0D%0A+*%2F%0D%0Alibrary+Address+%7B%0D%0A++++%2F**%0D%0A+++++*+%40dev+Returns+true+if+%60account%60+is+a+contract.%0D%0A+++++*%0D%0A+++++*+%5BIMPORTANT%5D%0D%0A+++++*+%3D%3D%3D%3D%0D%0A+++++*+It+is+unsafe+to+assume+that+an+address+for+which+this+function+returns%0D%0A+++++*+false+is+an+externally-owned+account+%28EOA%29+and+not+a+contract.%0D%0A+++++*%0D%0A+++++*+Among+others%2C+%60isContract%60+will+return+false+for+the+following%0D%0A+++++*+types+of+addresses%3A%0D%0A+++++*%0D%0A+++++*++-+an+externally-owned+account%0D%0A+++++*++-+a+contract+in+construction%0D%0A+++++*++-+an+address+where+a+contract+will+be+created%0D%0A+++++*++-+an+address+where+a+contract+lived%2C+but+was+destroyed%0D%0A+++++*+%3D%3D%3D%3D%0D%0A+++++*%2F%0D%0A++++function+isContract%28address+account%29+internal+view+returns+%28bool%29+%7B%0D%0A++++++++%2F%2F+This+method+relies+on+extcodesize%2C+which+returns+0+for+contracts+in%0D%0A++++++++%2F%2F+construction%2C+since+the+code+is+only+stored+at+the+end+of+the%0D%0A++++++++%2F%2F+constructor+execution.%0D%0A%0D%0A++++++++uint256+size%3B%0D%0A++++++++%2F%2F+solhint-disable-next-line+no-inline-assembly%0D%0A++++++++assembly+%7B+size+%3A%3D+extcodesize%28account%29+%7D%0D%0A++++++++return+size+%3E+0%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Replacement+for+Solidity%27s+%60transfer%60%3A+sends+%60amount%60+wei+to%0D%0A+++++*+%60recipient%60%2C+forwarding+all+available+gas+and+reverting+on+errors.%0D%0A+++++*%0D%0A+++++*+https%3A%2F%2Feips.ethereum.org%2FEIPS%2Feip-1884%5BEIP1884%5D+increases+the+gas+cost%0D%0A+++++*+of+certain+opcodes%2C+possibly+making+contracts+go+over+the+2300+gas+limit%0D%0A+++++*+imposed+by+%60transfer%60%2C+making+them+unable+to+receive+funds+via%0D%0A+++++*+%60transfer%60.+%7BsendValue%7D+removes+this+limitation.%0D%0A+++++*%0D%0A+++++*+https%3A%2F%2Fdiligence.consensys.net%2Fposts%2F2019%2F09%2Fstop-using-soliditys-transfer-now%2F%5BLearn+more%5D.%0D%0A+++++*%0D%0A+++++*+IMPORTANT%3A+because+control+is+transferred+to+%60recipient%60%2C+care+must+be%0D%0A+++++*+taken+to+not+create+reentrancy+vulnerabilities.+Consider+using%0D%0A+++++*+%7BReentrancyGuard%7D+or+the%0D%0A+++++*+https%3A%2F%2Fsolidity.readthedocs.io%2Fen%2Fv0.5.11%2Fsecurity-considerations.html%23use-the-checks-effects-interactions-pattern%5Bchecks-effects-interactions+pattern%5D.%0D%0A+++++*%2F%0D%0A++++function+sendValue%28address+payable+recipient%2C+uint256+amount%29+internal+%7B%0D%0A++++++++require%28address%28this%29.balance+%3E%3D+amount%2C+%22Address%3A+insufficient+balance%22%29%3B%0D%0A%0D%0A++++++++%2F%2F+solhint-disable-next-line+avoid-low-level-calls%2C+avoid-call-value%0D%0A++++++++%28bool+success%2C+%29+%3D+recipient.call%7B+value%3A+amount+%7D%28%22%22%29%3B%0D%0A++++++++require%28success%2C+%22Address%3A+unable+to+send+value%2C+recipient+may+have+reverted%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Performs+a+Solidity+function+call+using+a+low+level+%60call%60.+A%0D%0A+++++*+plain%60call%60+is+an+unsafe+replacement+for+a+function+call%3A+use+this%0D%0A+++++*+function+instead.%0D%0A+++++*%0D%0A+++++*+If+%60target%60+reverts+with+a+revert+reason%2C+it+is+bubbled+up+by+this%0D%0A+++++*+function+%28like+regular+Solidity+function+calls%29.%0D%0A+++++*%0D%0A+++++*+Returns+the+raw+returned+data.+To+convert+to+the+expected+return+value%2C%0D%0A+++++*+use+https%3A%2F%2Fsolidity.readthedocs.io%2Fen%2Flatest%2Funits-and-global-variables.html%3Fhighlight%3Dabi.decode%23abi-encoding-and-decoding-functions%5B%60abi.decode%60%5D.%0D%0A+++++*%0D%0A+++++*+Requirements%3A%0D%0A+++++*%0D%0A+++++*+-+%60target%60+must+be+a+contract.%0D%0A+++++*+-+calling+%60target%60+with+%60data%60+must+not+revert.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.1._%0D%0A+++++*%2F%0D%0A++++function+functionCall%28address+target%2C+bytes+memory+data%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++return+functionCall%28target%2C+data%2C+%22Address%3A+low-level+call+failed%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-%7D%5B%60functionCall%60%5D%2C+but+with%0D%0A+++++*+%60errorMessage%60+as+a+fallback+revert+reason+when+%60target%60+reverts.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.1._%0D%0A+++++*%2F%0D%0A++++function+functionCall%28address+target%2C+bytes+memory+data%2C+string+memory+errorMessage%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++++return+functionCallWithValue%28target%2C+data%2C+0%2C+errorMessage%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-%7D%5B%60functionCall%60%5D%2C%0D%0A+++++*+but+also+transferring+%60value%60+wei+to+%60target%60.%0D%0A+++++*%0D%0A+++++*+Requirements%3A%0D%0A+++++*%0D%0A+++++*+-+the+calling+contract+must+have+an+ETH+balance+of+at+least+%60value%60.%0D%0A+++++*+-+the+called+Solidity+function+must+be+%60payable%60.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.1._%0D%0A+++++*%2F%0D%0A++++function+functionCallWithValue%28address+target%2C+bytes+memory+data%2C+uint256+value%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++++return+functionCallWithValue%28target%2C+data%2C+value%2C+%22Address%3A+low-level+call+with+value+failed%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCallWithValue-address-bytes-uint256-%7D%5B%60functionCallWithValue%60%5D%2C+but%0D%0A+++++*+with+%60errorMessage%60+as+a+fallback+revert+reason+when+%60target%60+reverts.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.1._%0D%0A+++++*%2F%0D%0A++++function+functionCallWithValue%28address+target%2C+bytes+memory+data%2C+uint256+value%2C+string+memory+errorMessage%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++++require%28address%28this%29.balance+%3E%3D+value%2C+%22Address%3A+insufficient+balance+for+call%22%29%3B%0D%0A++++++++require%28isContract%28target%29%2C+%22Address%3A+call+to+non-contract%22%29%3B%0D%0A%0D%0A++++++++%2F%2F+solhint-disable-next-line+avoid-low-level-calls%0D%0A++++++++%28bool+success%2C+bytes+memory+returndata%29+%3D+target.call%7B+value%3A+value+%7D%28data%29%3B%0D%0A++++++++return+_verifyCallResult%28success%2C+returndata%2C+errorMessage%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-%7D%5B%60functionCall%60%5D%2C%0D%0A+++++*+but+performing+a+static+call.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.3._%0D%0A+++++*%2F%0D%0A++++function+functionStaticCall%28address+target%2C+bytes+memory+data%29+internal+view+returns+%28bytes+memory%29+%7B%0D%0A++++++++return+functionStaticCall%28target%2C+data%2C+%22Address%3A+low-level+static+call+failed%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-string-%7D%5B%60functionCall%60%5D%2C%0D%0A+++++*+but+performing+a+static+call.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.3._%0D%0A+++++*%2F%0D%0A++++function+functionStaticCall%28address+target%2C+bytes+memory+data%2C+string+memory+errorMessage%29+internal+view+returns+%28bytes+memory%29+%7B%0D%0A++++++++require%28isContract%28target%29%2C+%22Address%3A+static+call+to+non-contract%22%29%3B%0D%0A%0D%0A++++++++%2F%2F+solhint-disable-next-line+avoid-low-level-calls%0D%0A++++++++%28bool+success%2C+bytes+memory+returndata%29+%3D+target.staticcall%28data%29%3B%0D%0A++++++++return+_verifyCallResult%28success%2C+returndata%2C+errorMessage%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-%7D%5B%60functionCall%60%5D%2C%0D%0A+++++*+but+performing+a+delegate+call.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.4._%0D%0A+++++*%2F%0D%0A++++function+functionDelegateCall%28address+target%2C+bytes+memory+data%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++++return+functionDelegateCall%28target%2C+data%2C+%22Address%3A+low-level+delegate+call+failed%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++%2F**%0D%0A+++++*+%40dev+Same+as+%7Bxref-Address-functionCall-address-bytes-string-%7D%5B%60functionCall%60%5D%2C%0D%0A+++++*+but+performing+a+delegate+call.%0D%0A+++++*%0D%0A+++++*+_Available+since+v3.4._%0D%0A+++++*%2F%0D%0A++++function+functionDelegateCall%28address+target%2C+bytes+memory+data%2C+string+memory+errorMessage%29+internal+returns+%28bytes+memory%29+%7B%0D%0A++++++++require%28isContract%28target%29%2C+%22Address%3A+delegate+call+to+non-contract%22%29%3B%0D%0A%0D%0A++++++++%2F%2F+solhint-disable-next-line+avoid-low-level-calls%0D%0A++++++++%28bool+success%2C+bytes+memory+returndata%29+%3D+target.delegatecall%28data%29%3B%0D%0A++++++++return+_verifyCallResult%28success%2C+returndata%2C+errorMessage%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++function+_verifyCallResult%28bool+success%2C+bytes+memory+returndata%2C+string+memory+errorMessage%29+private+pure+returns%28bytes+memory%29+%7B%0D%0A++++++++if+%28success%29+%7B%0D%0A++++++++++++return+returndata%3B%0D%0A++++++++%7D+else+%7B%0D%0A++++++++++++%2F%2F+Look+for+revert+reason+and+bubble+it+up+if+present%0D%0A++++++++++++if+%28returndata.length+%3E+0%29+%7B%0D%0A++++++++++++++++%2F%2F+The+easiest+way+to+bubble+the+revert+reason+is+using+memory+via+assembly%0D%0A%0D%0A++++++++++++++++%2F%2F+solhint-disable-next-line+no-inline-assembly%0D%0A++++++++++++++++assembly+%7B%0D%0A++++++++++++++++++++let+returndata_size+%3A%3D+mload%28returndata%29%0D%0A++++++++++++++++++++revert%28add%2832%2C+returndata%29%2C+returndata_size%29%0D%0A++++++++++++++++%7D%0D%0A++++++++++++%7D+else+%7B%0D%0A++++++++++++++++revert%28errorMessage%29%3B%0D%0A++++++++++++%7D%0D%0A++++++++%7D%0D%0A++++%7D%0D%0A%7D%0D%0A%0D%0A%0D%0A%2F%2F+File+contracts%2Fproxy%2FUpgradeabilityProxy.sol%0D%0A%0D%0Apragma+solidity+%5E0.6.0%3B%0D%0A%0D%0A%0D%0A%2F**%0D%0A+*+%40title+UpgradeabilityProxy%0D%0A+*+%40dev+This+contract+implements+a+proxy+that+allows+to+change+the%0D%0A+*+implementation+address+to+which+it+will+delegate.%0D%0A+*+Such+a+change+is+called+an+implementation+upgrade.%0D%0A+*%2F%0D%0Acontract+UpgradeabilityProxy+is+Proxy+%7B%0D%0A++%2F**%0D%0A+++*+%40dev+Contract+constructor.%0D%0A+++*+%40param+_logic+Address+of+the+initial+implementation.%0D%0A+++*+%40param+_data+Data+to+send+as+msg.data+to+the+implementation+to+initialize+the+proxied+contract.%0D%0A+++*+It+should+include+the+signature+and+the+parameters+of+the+function+to+be+called%2C+as+described+in%0D%0A+++*+https%3A%2F%2Fsolidity.readthedocs.io%2Fen%2Fv0.4.24%2Fabi-spec.html%23function-selector-and-argument-encoding.%0D%0A+++*+This+parameter+is+optional%2C+if+no+data+is+given+the+initialization+call+to+proxied+contract+will+be+skipped.%0D%0A+++*%2F%0D%0A++constructor%28address+_logic%2C+bytes+memory+_data%29+public+payable+%7B%0D%0A++++assert%28IMPLEMENTATION_SLOT+%3D%3D+bytes32%28uint256%28keccak256%28%27eip1967.proxy.implementation%27%29%29+-+1%29%29%3B%0D%0A++++_setImplementation%28_logic%29%3B%0D%0A++++if%28_data.length+%3E+0%29+%7B%0D%0A++++++%28bool+success%2C%29+%3D+_logic.delegatecall%28_data%29%3B%0D%0A++++++require%28success%29%3B%0D%0A++++%7D%0D%0A++%7D++%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Emitted+when+the+implementation+is+upgraded.%0D%0A+++*+%40param+implementation+Address+of+the+new+implementation.%0D%0A+++*%2F%0D%0A++event+Upgraded%28address+indexed+implementation%29%3B%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Storage+slot+with+the+address+of+the+current+implementation.%0D%0A+++*+This+is+the+keccak-256+hash+of+%22eip1967.proxy.implementation%22+subtracted+by+1%2C+and+is%0D%0A+++*+validated+in+the+constructor.%0D%0A+++*%2F%0D%0A++bytes32+internal+constant+IMPLEMENTATION_SLOT+%3D+0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc%3B%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Returns+the+current+implementation.%0D%0A+++*+%40return+impl+Address+of+the+current+implementation%0D%0A+++*%2F%0D%0A++function+_implementation%28%29+internal+override+view+returns+%28address+impl%29+%7B%0D%0A++++bytes32+slot+%3D+IMPLEMENTATION_SLOT%3B%0D%0A++++assembly+%7B%0D%0A++++++impl+%3A%3D+sload%28slot%29%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Upgrades+the+proxy+to+a+new+implementation.%0D%0A+++*+%40param+newImplementation+Address+of+the+new+implementation.%0D%0A+++*%2F%0D%0A++function+_upgradeTo%28address+newImplementation%29+internal+%7B%0D%0A++++_setImplementation%28newImplementation%29%3B%0D%0A++++emit+Upgraded%28newImplementation%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Sets+the+implementation+address+of+the+proxy.%0D%0A+++*+%40param+newImplementation+Address+of+the+new+implementation.%0D%0A+++*%2F%0D%0A++function+_setImplementation%28address+newImplementation%29+internal+%7B%0D%0A++++require%28Address.isContract%28newImplementation%29%2C+%22Cannot+set+a+proxy+implementation+to+a+non-contract+address%22%29%3B%0D%0A%0D%0A++++bytes32+slot+%3D+IMPLEMENTATION_SLOT%3B%0D%0A%0D%0A++++assembly+%7B%0D%0A++++++sstore%28slot%2C+newImplementation%29%0D%0A++++%7D%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0A%0D%0A%2F%2F+File+contracts%2Fproxy%2FAdminUpgradeabilityProxy.sol%0D%0A%0D%0Apragma+solidity+%5E0.6.0%3B%0D%0A%0D%0A%2F**%0D%0A+*+%40title+AdminUpgradeabilityProxy%0D%0A+*+%40dev+This+contract+combines+an+upgradeability+proxy+with+an+authorization%0D%0A+*+mechanism+for+administrative+tasks.%0D%0A+*+All+external+functions+in+this+contract+must+be+guarded+by+the%0D%0A+*+%60ifAdmin%60+modifier.+See+ethereum%2Fsolidity%233864+for+a+Solidity%0D%0A+*+feature+proposal+that+would+enable+this+to+be+done+automatically.%0D%0A+*%2F%0D%0Acontract+AdminUpgradeabilityProxy+is+UpgradeabilityProxy+%7B%0D%0A++%2F**%0D%0A+++*+Contract+constructor.%0D%0A+++*+%40param+_logic+address+of+the+initial+implementation.%0D%0A+++*+%40param+_admin+Address+of+the+proxy+administrator.%0D%0A+++*+%40param+_data+Data+to+send+as+msg.data+to+the+implementation+to+initialize+the+proxied+contract.%0D%0A+++*+It+should+include+the+signature+and+the+parameters+of+the+function+to+be+called%2C+as+described+in%0D%0A+++*+https%3A%2F%2Fsolidity.readthedocs.io%2Fen%2Fv0.4.24%2Fabi-spec.html%23function-selector-and-argument-encoding.%0D%0A+++*+This+parameter+is+optional%2C+if+no+data+is+given+the+initialization+call+to+proxied+contract+will+be+skipped.%0D%0A+++*%2F%0D%0A++constructor%28address+_logic%2C+address+_admin%2C+bytes+memory+_data%29+UpgradeabilityProxy%28_logic%2C+_data%29+public+payable+%7B%0D%0A++++assert%28ADMIN_SLOT+%3D%3D+bytes32%28uint256%28keccak256%28%27eip1967.proxy.admin%27%29%29+-+1%29%29%3B%0D%0A++++_setAdmin%28_admin%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Emitted+when+the+administration+has+been+transferred.%0D%0A+++*+%40param+previousAdmin+Address+of+the+previous+admin.%0D%0A+++*+%40param+newAdmin+Address+of+the+new+admin.%0D%0A+++*%2F%0D%0A++event+AdminChanged%28address+previousAdmin%2C+address+newAdmin%29%3B%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Storage+slot+with+the+admin+of+the+contract.%0D%0A+++*+This+is+the+keccak-256+hash+of+%22eip1967.proxy.admin%22+subtracted+by+1%2C+and+is%0D%0A+++*+validated+in+the+constructor.%0D%0A+++*%2F%0D%0A%0D%0A++bytes32+internal+constant+ADMIN_SLOT+%3D+0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103%3B%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Modifier+to+check+whether+the+%60msg.sender%60+is+the+admin.%0D%0A+++*+If+it+is%2C+it+will+run+the+function.+Otherwise%2C+it+will+delegate+the+call%0D%0A+++*+to+the+implementation.%0D%0A+++*%2F%0D%0A++modifier+ifAdmin%28%29+%7B%0D%0A++++if+%28msg.sender+%3D%3D+_admin%28%29%29+%7B%0D%0A++++++_%3B%0D%0A++++%7D+else+%7B%0D%0A++++++_fallback%28%29%3B%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40return+The+address+of+the+proxy+admin.%0D%0A+++*%2F%0D%0A++function+admin%28%29+external+ifAdmin+returns+%28address%29+%7B%0D%0A++++return+_admin%28%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40return+The+address+of+the+implementation.%0D%0A+++*%2F%0D%0A++function+implementation%28%29+external+ifAdmin+returns+%28address%29+%7B%0D%0A++++return+_implementation%28%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Changes+the+admin+of+the+proxy.%0D%0A+++*+Only+the+current+admin+can+call+this+function.%0D%0A+++*+%40param+newAdmin+Address+to+transfer+proxy+administration+to.%0D%0A+++*%2F%0D%0A++function+changeAdmin%28address+newAdmin%29+external+ifAdmin+%7B%0D%0A++++require%28newAdmin+%21%3D+address%280%29%2C+%22Cannot+change+the+admin+of+a+proxy+to+the+zero+address%22%29%3B%0D%0A++++emit+AdminChanged%28_admin%28%29%2C+newAdmin%29%3B%0D%0A++++_setAdmin%28newAdmin%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Upgrade+the+backing+implementation+of+the+proxy.%0D%0A+++*+Only+the+admin+can+call+this+function.%0D%0A+++*+%40param+newImplementation+Address+of+the+new+implementation.%0D%0A+++*%2F%0D%0A++function+upgradeTo%28address+newImplementation%29+external+ifAdmin+%7B%0D%0A++++_upgradeTo%28newImplementation%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Upgrade+the+backing+implementation+of+the+proxy+and+call+a+function%0D%0A+++*+on+the+new+implementation.%0D%0A+++*+This+is+useful+to+initialize+the+proxied+contract.%0D%0A+++*+%40param+newImplementation+Address+of+the+new+implementation.%0D%0A+++*+%40param+data+Data+to+send+as+msg.data+in+the+low+level+call.%0D%0A+++*+It+should+include+the+signature+and+the+parameters+of+the+function+to+be+called%2C+as+described+in%0D%0A+++*+https%3A%2F%2Fsolidity.readthedocs.io%2Fen%2Fv0.4.24%2Fabi-spec.html%23function-selector-and-argument-encoding.%0D%0A+++*%2F%0D%0A++function+upgradeToAndCall%28address+newImplementation%2C+bytes+calldata+data%29+payable+external+ifAdmin+%7B%0D%0A++++_upgradeTo%28newImplementation%29%3B%0D%0A++++%28bool+success%2C%29+%3D+newImplementation.delegatecall%28data%29%3B%0D%0A++++require%28success%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40return+adm+The+admin+slot.%0D%0A+++*%2F%0D%0A++function+_admin%28%29+internal+view+returns+%28address+adm%29+%7B%0D%0A++++bytes32+slot+%3D+ADMIN_SLOT%3B%0D%0A++++assembly+%7B%0D%0A++++++adm+%3A%3D+sload%28slot%29%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Sets+the+address+of+the+proxy+admin.%0D%0A+++*+%40param+newAdmin+Address+of+the+new+proxy+admin.%0D%0A+++*%2F%0D%0A++function+_setAdmin%28address+newAdmin%29+internal+%7B%0D%0A++++bytes32+slot+%3D+ADMIN_SLOT%3B%0D%0A%0D%0A++++assembly+%7B%0D%0A++++++sstore%28slot%2C+newAdmin%29%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F**%0D%0A+++*+%40dev+Only+fall+back+when+the+sender+is+not+the+admin.%0D%0A+++*%2F%0D%0A++function+_willFallback%28%29+internal+override+virtual+%7B%0D%0A++++require%28msg.sender+%21%3D+_admin%28%29%2C+%22Cannot+call+fallback+function+from+the+proxy+admin%22%29%3B%0D%0A++++super._willFallback%28%29%3B%0D%0A++%7D%0D%0A%7D%0D%0A&smart_contract%5Bautodetect_contructor_args%5D=true&smart_contract%5Bconstructor_arguments%5D=&external_libraries%5Blibrary1_name%5D=&external_libraries%5Blibrary1_address%5D=&external_libraries%5Blibrary2_name%5D=&external_libraries%5Blibrary2_address%5D=&external_libraries%5Blibrary3_name%5D=&external_libraries%5Blibrary3_address%5D=&external_libraries%5Blibrary4_name%5D=&external_libraries%5Blibrary4_address%5D=&external_libraries%5Blibrary5_name%5D=&external_libraries%5Blibrary5_address%5D=&external_libraries%5Blibrary6_name%5D=&external_libraries%5Blibrary6_address%5D=&external_libraries%5Blibrary7_name%5D=&external_libraries%5Blibrary7_address%5D=&external_libraries%5Blibrary8_name%5D=&external_libraries%5Blibrary8_address%5D=&external_libraries%5Blibrary9_name%5D=&external_libraries%5Blibrary9_address%5D=&external_libraries%5Blibrary10_name%5D=&smart_contract%5Blibrary10_address%5D=`,
  });
  if (!response.ok) {
    throw new Error(
      `Could not verify proxy address ${address} on network ${network}`
    );
  }
}

module.exports = { verifyProxy, verifyImpl };
